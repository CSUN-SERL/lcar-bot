<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="http://cdn.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
<script type="text/javascript" src="http://cdn.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
<script src="http://maps.google.com/maps/api/js?sensor=false"></script>

  <script>
var longitude =0;
var latitude =0;
 
 // Connecting to ROS
  // -----------------

 var ros = new ROSLIB.Ros({ //creating ros object
    url : 'ws://localhost:9090'
  });

ros.on('connection', function() {
    console.log('Connected to websocket server.');
  });

  ros.on('error', function(error) {
    console.log('Error connecting to websocket server: ', error);
  });

  ros.on('close', function() {
    console.log('Connection to websocket server closed.');
  });


// Subscribing to a Topic
  // ----------------------

  var listener = new ROSLIB.Topic({
    ros : ros, 	//ros object connection
    name : 'mavros/global_position/global',
    messageType : 'sensor_msgs/NavSatFix'
  });

  listener.subscribe(function(message) {
    console.log('latitude ' + listener.name + ': ' + message.latitude);
   console.log('longitude ' + listener.name + ': ' + message.longitude);

	longitude = message.longitude;
	latitude = message.latitude;
	console.log('latitude1 ' + longitude);
 	  console.log('longitude1 ' + latitude);
$(document).ready(function(){
	   //getLocation();
     showPosition();
			});

    	listener.unsubscribe();
  });


var x =-118;
var y =34;
var map;
var marker;
var newPoint ;
var la ;
function getLocation() {
   //if (navigator.geolocation) {
  //     navigator.geolocation.getCurrentPosition(showPosition, showError);
   //} else {
  //     x.innerHTML = "Geolocation is not supported by this browser.";
  //  }

}

function showPosition() {
 console.log('latitude ' + longitude);
   console.log('longitude ' + latitude);

    //lat = position.coords.latitude;
    //lon = position.coords.longitude;
    latlon = new google.maps.LatLng(longitude, latitude)
    mapholder = document.getElementById('mapholder')
    mapholder.style.height = '250px';
    mapholder.style.width = '500px';

    var myOptions = {
    center:latlon,zoom:14,
    mapTypeId:google.maps.MapTypeId.ROADMAP,
    mapTypeControl:false,
    navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL}
    }

     map = new google.maps.Map(document.getElementById("mapholder"), myOptions);
     marker = new google.maps.Marker({position:latlon,map:map,title:"You are here!"});

    update();
}

function update() {
  //navigator.geolocation.getCurrentPosition(function(position) {
     //newPoint = new google.maps.LatLng( position.coords.latitude,
                                          // position.coords.longitude);

la = new google.maps.LatLng(latitude,
    longitude);

    if (marker) {
      // Marker already created - Move it
      marker.setPosition(la);
    }
    else {
      // Marker does not exist - Create it
      marker = new google.maps.Marker({
        position: la,
        map: map
      });
    }

    // Center the map on the new position
    map.setCenter(la);
  //});

  // Call the autoUpdate() function every 5 seconds
  outmessage.innerHTML = newPoint ;
  longitude += .00055;
  setTimeout(update, 50);
}

function showError(error) {
    switch(error.code) {
        case error.PERMISSION_DENIED:
            x.innerHTML = "User denied the request for Geolocation."
            break;
        case error.POSITION_UNAVAILABLE:
            x.innerHTML = "Location information is unavailable."
            break;
        case error.TIMEOUT:
            x.innerHTML = "The request to get user location timed out."
            break;
        case error.UNKNOWN_ERROR:
            x.innerHTML = "An unknown error occurred."
            break;
    }
}


 
    </script>
</head>
<body>

<p id="outmessage"></p>



<div id="mapholder"></div>




</body>
</html>
